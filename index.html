---
layout: default
---

<style>
svg {
  font-size: 10px;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.area {
  fill: #F37F75;
}

.highLine {
  fill: none;
  stroke: #FF2B1A;
  stroke-width: 3.0px;
}

.lowLine {
  fill: none;
  stroke: #00D15A;
  stroke-width: 3.0px;
}

#dashboard {
  padding-top: 70px;
}

.col-md-4 {
  padding-top: 15px;
}

#nav {
  position: fixed;
  z-index: 1;
  width: 100%;
  background-color: #eee;
  padding-bottom: 15px;
  border-bottom: 1px solid black;
}

.select2-container--bootstrap .select2-selection,
.select2-container--bootstrap .select2-search--dropdown .select2-search__field,
.select2-results {
  font-size: 16px;
}

#start, #end {
  font-size: 16px;
}

#view_by_type, #view_by_ward {
  display: inline-block;
  height: 34px;
  padding-top: 6px;
  font-size: 16px;
}

</style>

<script>
  function change_service_type(start_date, end_date) {
    $(document).ready(function() {
      var select = document.getElementById("service_types");
      var code = select.options[select.selectedIndex].value;

      var params = [start_date, end_date, "breakdown=ward", "code=" + code];
      var stateObj = { code: code };
      history.pushState(stateObj, "", "?" + params.join("&"))
      graph_by_code(code);
    });
  }

  function change_ward(start_date, end_date) {
    $(document).ready(function() {
      var select = document.getElementById("wards");
      var ward = select.options[select.selectedIndex].value;

      var params = [start_date, end_date, "breakdown=service", "ward=" + ward];
      var stateObj = { ward: ward };
      history.pushState(stateObj, "", "?" + params.join("&"));
      graph_by_ward(ward);
    });
  }

  function change_date() {
    $(document).ready(function() {
      var mindate = "2010-01-01",
          maxdate = "2016-05-31";

      var start_date = document.getElementById("start").value,
          end_date = document.getElementById("end").value;

      if (start_date != mindate || end_date != maxdate) {
        var dates = ["start=" + start_date, "end=" + end_date];

        var link = window.location.href;
        var breakdown = parseUri(link)["queryKey"]["breakdown"];

        if (breakdown == "ward" || breakdown == null) {
          change_service_type("start=" + start_date, "end=" + end_date);
        } else if (breakdown == "service") {
          change_ward("start=" + start_date, "end=" + end_date);
        }
      }
    });
  }
</script>

<div id="nav">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-4">
        <div class="input-daterange input-group" id="datepicker">
          <input type="text" class="form-control" name="start" id="start" value="2010-01-01" onChange="change_date();"/>
          <span class="input-group-addon">to</span>
          <input type="text" class="form-control" name="end" id="end" value="2016-05-31" onChange="change_date();" />
        </div>
      </div>

      <div class="col-md-4 text-center">
        <select class="form-control select2" id="service_types" onchange="change_service_type();">
          <option value="all-services">All service types</option>
          <option value="5743">Bins for Trash & Recycling</option>
          <option value="122">Graffiti</option>
          <option value="6215">Hangers</option>
          <option value="5185">Health Complaints</option>
          <option value="1250">Illegal Dumping</option>
          <option value="12386">Library Issues</option>
          <option value="374">Other</option>
          <option value="3018">Other - city responsibility</option>
          <option value="372">Parking Meter</option>
          <option value="121">Parking Violation/Abandoned Auto</option>
          <option value="126">Parks Request</option>
          <option value="2626">Policing Issue</option>
          <option value="116">Potholes</option>
          <option value="1251">Private Property Issue</option>
          <option value="1249">Public Space, Streets and Drains</option>
          <option value="117">Sidewalks and Curb damage</option>
          <option value="373">Signs / Bus Shelters / Pavement Markings</option>
          <option value="124">Street Lamp</option>
          <option value="5251">Street Sweeping</option>
          <option value="51">Traffic Signal / Pedestrian Signal</option>
          <option value="2625">Traffic/Road Safety</option>
          <option value="1966">Trash & Recycling</option>
          <option value="1853">Tree Trimming</option>
        </select>

        <select class="form-control select2" id="wards" onchange="change_ward();">
          <option value="all-wards">All wards</option>
          <option value="1">Ward 1</option>
          <option value="2">Ward 2</option>
          <option value="3">Ward 3</option>
          <option value="4">Ward 4</option>
          <option value="5">Ward 5</option>
          <option value="6">Ward 6</option>
          <option value="7">Ward 7</option>
          <option value="8">Ward 8</option>
          <option value="9">Ward 9</option>
          <option value="10">Ward 10</option>
          <option value="11">Ward 11</option>
          <option value="12">Ward 12</option>
          <option value="13">Ward 13</option>
          <option value="14">Ward 14</option>
          <option value="15">Ward 15</option>
          <option value="16">Ward 16</option>
          <option value="17">Ward 17</option>
          <option value="18">Ward 18</option>
          <option value="19">Ward 19</option>
          <option value="20">Ward 20</option>
          <option value="21">Ward 21</option>
          <option value="22">Ward 22</option>
          <option value="23">Ward 23</option>
          <option value="24">Ward 24</option>
          <option value="25">Ward 25</option>
          <option value="26">Ward 26</option>
          <option value="27">Ward 27</option>
          <option value="28">Ward 28</option>
          <option value="29">Ward 29</option>
          <option value="30">Ward 30</option>
        </select>
      </div>

      <div class="col-md-4 text-right">
          <a id="view_by_type" href="{{ '/?breakdown=service&ward=all-wards' | prepend: site.baseurl }}">View issues by service type</a>
          <a id="view_by_ward" href="{{ '/?breakdown=ward&code=all-services' | prepend: site.baseurl }}">View issues by ward</a>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid" id="dashboard">
  <div id="graphs" class="row text-center"></div>
</div>

<script>
  $(document).ready(function() {
    $(".input-daterange").datepicker({
      format: "yyyy-mm-dd",
      maxViewMode: 2,
      todayHighlight: true
    });

    $.fn.select2.defaults.set("width", null);
    $.fn.select2.defaults.set("theme", "bootstrap");

    var link = window.location.href;
    var breakdown = parseUri(link)["queryKey"]["breakdown"],
        code = parseUri(link)["queryKey"]["code"],
        ward = parseUri(link)["queryKey"]["ward"];

    if(breakdown == "ward") {
      $("#service_types").show().select2();
      $("#view_by_type").show();
      $("#wards").hide();
      $("#view_by_ward").hide();

      if(code == null) {
        graph_by_code("all-services");
      } else {
        var select = document.getElementById("service_types");
        select.value = code;
        graph_by_code(code);
      }
    } else if(breakdown == "service") {
      $("#service_types").hide();
      $("#view_by_type").hide();
      $("#wards").show().select2();
      $("#view_by_ward").show();

      if(ward == null) {
        graph_by_ward("all-wards");
      } else {
        var select = document.getElementById("wards");
        select.value = ward;
        graph_by_ward(ward);
      }
    } else if(breakdown == null) {
      $("#service_types").show().select2();
      $("#view_by_type").show();
      $("#wards").hide();
      $("#view_by_ward").hide();

      graph_by_code("all-services");
    }
  });
</script>
